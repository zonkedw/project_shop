# FoodShop - Интернет-магазин продуктов питания

Полнофункциональный интернет-магазин продуктов питания, разработанный на React.js с backend на Node.js и PostgreSQL.

## Реализованный функционал

### Интерфейс авторизации и регистрации

Создана полноценная система аутентификации пользователей:

- **Страница регистрации** (`/register`) с валидацией полей в реальном времени
- **Страница авторизации** (`/login`) с современным дизайном
- Валидация email, проверка сложности пароля
- Подтверждение пароля при регистрации
- Автоматическое заполнение данных для авторизованных пользователей
- Сохранение сессии через JWT токены в localStorage

### API интеграция

#### a. Вывод товаров

Реализована система загрузки товаров с сервера:

- API endpoint `/api/products/categories/grouped` для получения товаров по категориям
- Группировка товаров: акции, новинки, популярные
- Fallback на локальные данные при недоступности сервера
- Моковые данные для демонстрации при пустой базе данных
- Обработка ошибок загрузки с возможностью повторного запроса

#### b. Регистрация/авторизация

Полная интеграция с backend API:

- Endpoints `/api/auth/register` и `/api/auth/login`
- JWT токены для авторизации
- Middleware для проверки авторизации на защищенных маршрутах
- Автоматическое обновление состояния авторизации в приложении
- Безопасное хранение токенов и данных пользователя

#### c. Добавление и вывод новостей

Система управления новостями:

- Просмотр новостей доступен всем пользователям
- Добавление новостей только для авторизованных пользователей
- API endpoints `/api/news` (GET, POST)
- Валидация данных на клиенте и сервере
- Автоматическое обновление списка после добавления новости
- Отображение автора и даты создания новости

### Страница оформления заказов

Разработана полноценная система оформления заказов:

- **Форма заказа** с валидацией всех полей
- **Контактные данные**: имя, фамилия, email, телефон
- **Адрес доставки**: выбор способа доставки (курьер/самовывоз)
- **Способ оплаты**: банковская карта или наличные при получении
- **Сводка заказа** с подсчетом стоимости доставки
- **Страница успешного оформления** заказа
- Интеграция с корзиной товаров
- Сохранение заказов в базе данных PostgreSQL

## Техническая реализация

### Frontend (React.js)

- Современный UI с использованием CSS Grid и Flexbox
- Адаптивный дизайн для всех устройств
- Валидация форм в реальном времени
- Управление состоянием через Context API
- Роутинг с React Router
- Обработка ошибок и loading состояний

### Backend (Node.js + Express)

- RESTful API с полной документацией
- JWT аутентификация
- Валидация данных на сервере
- CORS настройки для работы с frontend
- Rate limiting для защиты от спама
- Подробное логирование запросов

### База данных (PostgreSQL)

- Таблицы: users, news, orders, order_items
- Связи между таблицами с внешними ключами
- Индексы для оптимизации запросов
- Триггеры для автоматического обновления timestamps
- Транзакции для целостности данных при создании заказов

## Структура проекта

```
project_shop/
├── frontend/
│   ├── public/
│   │   └── index.html
│   └── src/
│       ├── components/          # React компоненты
│       │   ├── AuthForm/        # Компоненты авторизации
│       │   ├── Cart/            # Корзина товаров
│       │   ├── Header/          # Шапка сайта
│       │   └── ...
│       ├── pages/               # Страницы приложения
│       │   ├── Login.js         # Страница входа
│       │   ├── Register.js      # Страница регистрации
│       │   ├── News.js          # Страница новостей
│       │   ├── Checkout.js      # Оформление заказа
│       │   └── Home.js          # Главная страница
│       ├── context/             # Context API
│       │   ├── AuthContext.js   # Контекст авторизации
│       │   └── CartContext.js   # Контекст корзины
│       ├── services/            # API клиенты
│       │   └── api.js           # HTTP запросы к серверу
│       ├── hooks/               # Пользовательские хуки
│       │   └── useFormValidation.js
│       └── utils/               # Утилиты
│           └── priceUtils.js    # Работа с ценами
├── backend/
│   ├── routes/                  # API маршруты
│   │   ├── auth.js              # Авторизация
│   │   ├── news.js              # Новости
│   │   ├── orders.js            # Заказы
│   │   └── products.js          # Товары
│   ├── middleware/              # Middleware
│   │   └── auth.js              # Проверка JWT токенов
│   ├── config/                  # Конфигурация
│   │   └── database.js          # Подключение к PostgreSQL
│   └── database/                # SQL скрипты
│       └── create_orders_tables.sql
├── backend/package.json
├── frontend/package.json
└── package.json
```

## Установка и запуск

1. Установка зависимостей (корень, backend, frontend):
```bash
npm run install:all
```

2. Инициализация базы данных PostgreSQL

```bash
npm run init-db
```

3. Настройка переменных окружения:
- `backend/.env` — параметры БД, JWT и порт (по умолчанию `PORT=4000`)
- `frontend/.env` — например: `REACT_APP_API_URL=http://localhost:4000`
- `ADMIN_EMAIL`, `ADMIN_PASSWORD` — учётные данные администратора (создаются при выполнении `npm run init-db`)

4. Запуск в режиме разработки (одновременно backend и frontend):
```bash
npm run dev
```

Альтернативно:
```bash
# Только backend (dev с nodemon)
npm run dev:backend

# Только frontend (CRA на :3000)
npm run start:frontend

# Сборка фронтенда
npm run build:frontend
```

## Особенности реализации

- Безопасная работа с ценами через утилиты priceUtils
- Детальная валидация форм с показом ошибок в реальном времени
- Обработка всех возможных состояний загрузки и ошибок
- Современный дизайн с градиентами и анимациями
- Полная адаптивность для мобильных устройств
- Оптимизированные SQL запросы с индексами
- Транзакционная целостность при создании заказов

Приложение готово к продакшену и может быть развернуто на любом хостинге с поддержкой Node.js и PostgreSQL.

## Изменения (17.10.2025)

- **Поиск**: добавлены подсказки (до 6 элементов, кнопка «Показать все»), страница результатов с фильтрами, сортировками и пагинацией.
- **Каталог**: выпадающая сетка категорий при ховере, кликабельные пункты, устойчивое поведение при наведении.
- **Категории**: страница `'/category/:name'` с фильтрами (цена/новинки/скидки), сортировкой и пагинацией.
- **Товар**: страница `'/product/:id'` с ценой, рейтингом, описанием и блоком «С этим товаром покупают».
- **Избранное**: сердечко на карточке (toggle), страница `'/favorites'`, хранение в `localStorage`.
- **Статика**: страницы `'/about'`, `'/contacts'`, `'/vacancies'`; обновлены ссылки в футере.
- **API**: добавлены `GET /api/products/search`, `GET /api/products/suggest`, `GET /api/products/by-ids`, `GET /api/products/related/:id`; расширен `GET /api/products` фильтрами и сортировкой.

## Изменения (21.10.2025)

- **Backend**
  - **CORS**: разрешён метод `PATCH`, добавлена явная обработка preflight `OPTIONS` в `backend/server.js`.
  - **Заказы**: расширены эндпоинты в `backend/routes/orders.js`:
    - `PATCH /api/orders/:id/status` — смена статуса заказа (только админ).
    - `GET /api/orders/all` — список всех заказов с фильтрами (только админ).
    - `DELETE /api/orders/:id` — удаление заказа (только админ).
    - `POST /api/orders/:id/cancel` — отмена заказа пользователем.
    - `POST /api/orders/:id/discount` — применение промокода к заказу.
    - При создании заказа сохраняются `subtotal_price`, `discount_code`, `discount_amount`, `total_price`.
  - **Инициализация БД**: добавлен скрипт `npm run init-db` для гарантии актуальных таблиц и колонок (включая `orders`/`order_items`).

- **Frontend**
  - **Страницы**: добавлена админ-страница заказов `'/admin/orders'` (`frontend/src/pages/AdminOrders.js`) — список заказов, фильтрация по статусам/поиску, смена статуса, удаление заказа.
  - **Навигация**: в `frontend/src/components/Header/Header.js` добавлены ссылки «Мои заказы» (для авторизованных) и «Заказы (админ)» (для админов).
  - **UX**: в `frontend/src/pages/AdminLogin.js` добавлены атрибуты `autocomplete` для полей email и пароля.

- **API-клиент (frontend/src/services/api.js)**
  - Добавлены методы работы с заказами для админа: `getAllOrdersAdmin`, `updateOrderStatus`, `deleteOrderAdmin` (и сопутствующие пользовательские операции).

- **Запуск**
  - Перед стартом разработки выполнять `npm run init-db`, далее `npm run dev`.

## Изменения (05.11.2025)

- **Инфостраницы** (frontend): добавлены и подключены страницы
  - `/sales` (Акции), `/new` (Новинки), `/popular` (Популярное), `/brands` (Бренды)
  - `/delivery` (Доставка), `/payment` (Оплата), `/returns` (Возврат товара)
  - `/partners` (Партнёрам), `/suppliers` (Поставщикам), `/franchise` (Франшиза), `/advertising` (Реклама), `/cooperation` (Сотрудничество)
  - Обновлены ссылки в Header/Footer на роуты.
- **Каталог и категории**:
  - Добавлены изображения для категорий, переведены на локальные ассеты в `frontend/public/images/categories/`.
  - Дропдаун «Каталог» в шапке показывает миниатюры категорий.
  - Страница каталога `/catalog` и карточки категорий отображают корректные изображения.
- **Главная страница (Наши магазины)**:
  - Убрано лишнее пустое место: колонки растянуты по высоте, уменьшены отступы.
  - Блок «Адреса и контакты» сделан липким, с внутренней прокруткой и аккуратным скроллбаром.
- **Страница категории**:
  - Переработан фильтр: вынесены стили в `Category.css`, стабильная сетка сайдбара.
  - Исправлено «съезжание» блока цены и элементов при вводе/фокусе.
- **Товары/сидинг (backend)**:
  - Расширено наполнение тестовыми товарами с фото по категориям.
  - Сидер сделан идемпотентным: повторный запуск не создаёт дубликаты (проверка по `name`).
  - Сидинг выполняется, если в БД меньше заданного порога товаров.
- **Авторизация**:
  - Добавлены и задокументированы `JWT_SECRET` и `JWT_EXPIRES_IN` в `backend/.env`.
- **DB/DevOps**:
  - Обновлён процесс инициализации: `npm run init-db` гарантирует актуальные таблицы и первоначальные данные.

Как запустить после обновлений:
```
npm run init-db
npm run dev
```
