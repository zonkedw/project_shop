# FitPilot

Персональная платформа для управления фитнесом с искусственным интеллектом.

## Информация о проекте

**Модуль:** ПМ.09 Проектирование, разработка и оптимизация веб-приложений  
**Группа:** 22ИС4-2  
**Срок сдачи:** 19 декабря 2025

**Авторы:**
- Качкалов Максим Олегович
- Чернышова Варвара Юрьевна
- Шпитонков Константин Александрович

**Руководитель:** Федотов Иван Вячеславович

## Описание системы

FitPilot - это комплексная платформа для управления фитнесом, которая использует технологии искусственного интеллекта для создания персонализированных планов питания и тренировок. Система предназначена для пользователей, которые хотят достичь своих фитнес-целей с помощью умного планирования и отслеживания прогресса.

### Ключевые особенности

**Искусственный интеллект:**
- Персональный AI-ассистент для консультаций по питанию и тренировкам
- Автоматическая генерация рационов питания на основе целей пользователя
- Создание индивидуальных планов тренировок с учетом локации и оборудования
- Анализ прогресса и предоставление рекомендаций
- Логирование всех AI-взаимодействий для отслеживания использования и стоимости

**Управление питанием:**
- База данных продуктов питания с поддержкой российского рынка
- Отслеживание калорий и макронутриентов (белки, углеводы, жиры)
- Дневник питания с разбивкой по приемам пищи
- Автоматический расчет БЖУ на основе съеденных продуктов
- Поиск продуктов по названию и штрих-коду

**Управление тренировками:**
- Библиотека упражнений с фильтрацией по группам мышц
- Конструктор тренировок для создания персональных планов
- Отслеживание тренировочных сессий с детализацией подходов
- Статистика тренировок и анализ прогресса
- История тренировок с возможностью просмотра деталей

**Профиль пользователя:**
- Настройка целей (похудение, набор веса, поддержание, набор мышечной массы)
- Установка целевых значений калорий и БЖУ
- Отслеживание физических параметров (вес, рост)
- Настройка уровня активности
- История изменений параметров тела

**Рецепты:**
- Создание и сохранение собственных рецептов
- Расчет калорийности и БЖУ рецептов
- Просмотр и редактирование сохраненных рецептов

## Технологический стек

**Frontend:**
- React Native 0.81.5
- Expo ~54.0.23
- React Navigation 7.x
- React Native Reanimated 3.16.1
- Expo Linear Gradient 14.0.1
- Axios 1.13.2
- AsyncStorage 2.2.0

**Backend:**
- Node.js
- Express.js
- PostgreSQL 14+
- JWT (jsonwebtoken)
- Bcrypt для хеширования паролей
- Celebrate/Joi для валидации
- Express Rate Limit для ограничения запросов
- Helmet для безопасности

**База данных:**
- PostgreSQL
- 18 таблиц для хранения данных пользователей, продуктов, тренировок, AI-взаимодействий

**AI интеграция:**
- Поддержка внешних AI API (OpenAI, Anthropic и другие)
- Fallback-логика при недоступности внешнего AI
- Логирование токенов и стоимости использования

## Структура проекта

```
project_shop-kursov_fitness/
├── backend/                    # Серверная часть
│   ├── routes/                # API роуты
│   │   ├── auth.js           # Аутентификация
│   │   ├── users.js          # Управление пользователями
│   │   ├── nutrition.js      # Питание и продукты
│   │   ├── workouts.js       # Тренировки и упражнения
│   │   ├── recipes.js        # Рецепты
│   │   └── ai.js             # AI-ассистент
│   ├── config/               # Конфигурация
│   │   ├── database.js       # Подключение к БД
│   │   └── index.js          # Валидация переменных окружения
│   ├── middleware/           # Middleware
│   │   ├── auth.js          # JWT аутентификация
│   │   └── errorHandler.js  # Обработка ошибок
│   ├── services/            # Сервисы
│   │   └── aiLogger.js      # Логирование AI-взаимодействий
│   ├── validators/          # Валидация запросов
│   │   └── aiValidators.js  # Схемы валидации для AI
│   ├── __tests__/          # Тесты
│   │   └── ai.test.js      # Тесты AI роутов
│   ├── server.js           # Точка входа сервера
│   └── .env.example        # Пример конфигурации
├── frontend/                # Клиентская часть
│   ├── src/
│   │   ├── screens/        # Экраны приложения
│   │   │   ├── LoginScreen.js
│   │   │   ├── RegisterScreen.js
│   │   │   ├── HomeScreen.js
│   │   │   ├── LandingScreen.js
│   │   │   ├── ChatScreen.js
│   │   │   ├── NutritionScreen.js
│   │   │   ├── WorkoutsScreen.js
│   │   │   ├── ProfileScreen.js
│   │   │   ├── AboutScreen.js
│   │   │   ├── FeaturesScreen.js
│   │   │   └── ...
│   │   ├── components/     # Переиспользуемые компоненты
│   │   │   ├── Header.js
│   │   │   ├── AnimatedCard.js
│   │   │   ├── GradientButton.js
│   │   │   ├── LoadingIndicator.js
│   │   │   ├── ErrorMessage.js
│   │   │   ├── StatCard.js
│   │   │   ├── MealCard.js
│   │   │   └── WorkoutCard.js
│   │   ├── services/      # API клиент
│   │   │   └── api.js
│   │   ├── hooks/         # Кастомные хуки
│   │   │   └── useApi.js
│   │   ├── utils/         # Утилиты
│   │   │   ├── cache.js
│   │   │   └── errorHandler.js
│   │   ├── theme/         # Тема и стили
│   │   │   ├── colors.js
│   │   │   └── styles.js
│   │   └── config/        # Конфигурация
│   │       └── api.js
│   ├── App.js            # Корневой компонент
│   ├── app.json          # Конфигурация Expo
│   └── package.json      # Зависимости
├── database/
│   └── schema.sql        # Схема базы данных
└── README.md            # Документация проекта
```

## Установка и запуск

### Требования

- Node.js 16+
- PostgreSQL 14+
- npm или yarn

### База данных

1. Создайте базу данных PostgreSQL:
```sql
CREATE DATABASE fitpilot_db;
```

2. Выполните схему базы данных:
```bash
psql -U postgres -d fitpilot_db -f database/schema.sql
```

Или в pgAdmin: подключитесь к базе данных `fitpilot_db` и выполните содержимое файла `database/schema.sql`.

### Backend

1. Перейдите в директорию backend:
```bash
cd backend
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

3. Заполните переменные окружения в `.env`:
```
DB_HOST=localhost
DB_PORT=5432
DB_NAME=fitpilot_db
DB_USER=postgres
DB_PASSWORD=your_password

JWT_SECRET=your_random_secret_string
JWT_EXPIRES_IN=7d

PORT=3000

# Опционально для AI функционала
AI_API_URL=https://api.openai.com
AI_API_KEY=your_api_key
AI_MODEL=gpt-4o-mini

CORS_ORIGINS=http://localhost:8081,http://localhost:19006
```

4. Установите зависимости:
```bash
npm install
```

5. Запустите сервер:
```bash
npm run dev
```

Сервер будет доступен по адресу `http://localhost:3000`

### Frontend

1. Перейдите в директорию frontend:
```bash
cd frontend
```

2. Установите зависимости:
```bash
npm install
```

3. Настройте API URL:
   - Для разработки на ПК/эмуляторе: по умолчанию используется `http://localhost:3000/api`
   - Для реального устройства: измените IP в `src/config/api.js` или `app.json`

4. Запустите приложение:
```bash
npm start
```

5. Откройте приложение:
   - В браузере: нажмите `w` в терминале Expo
   - На мобильном устройстве: отсканируйте QR-код в приложении Expo Go

## API Документация

### Аутентификация

**POST /api/auth/register**
- Регистрация нового пользователя
- Тело запроса: `{ email, password, username }`
- Возвращает: токен JWT и данные пользователя

**POST /api/auth/login**
- Вход в систему
- Тело запроса: `{ email, password }`
- Возвращает: токен JWT и данные пользователя

### Пользователи

**GET /api/users/profile**
- Получение профиля текущего пользователя
- Требует аутентификации

**PUT /api/users/profile**
- Обновление профиля пользователя
- Тело запроса: данные профиля (цели, параметры, БЖУ)
- Требует аутентификации

**POST /api/users/measurements**
- Добавление измерения параметров тела
- Тело запроса: `{ date, weight_kg, body_fat_percent, muscle_mass_kg, ... }`
- Требует аутентификации

**GET /api/users/measurements**
- Получение истории измерений
- Параметры запроса: `start_date`, `end_date`
- Требует аутентификации

### Питание

**GET /api/nutrition/products/search**
- Поиск продуктов по названию
- Параметры запроса: `q` (поисковый запрос)
- Требует аутентификации

**GET /api/nutrition/products/barcode/:barcode**
- Поиск продукта по штрих-коду
- Требует аутентификации

**GET /api/nutrition/products/:id**
- Получение информации о продукте
- Требует аутентификации

**POST /api/nutrition/products**
- Создание нового продукта
- Тело запроса: данные продукта
- Требует аутентификации

**GET /api/nutrition/categories**
- Получение списка категорий продуктов
- Требует аутентификации

**POST /api/nutrition/meals**
- Добавление приема пищи
- Тело запроса: `{ meal_date, meal_type, items: [{ product_id, quantity_g }] }`
- Требует аутентификации

**GET /api/nutrition/diary**
- Получение дневника питания
- Параметры запроса: `date` (YYYY-MM-DD)
- Требует аутентификации

**DELETE /api/nutrition/meals/:id**
- Удаление приема пищи
- Требует аутентификации

### Тренировки

**GET /api/workouts/exercises**
- Получение списка упражнений
- Параметры запроса: `muscle_group`, `equipment`, `search`
- Требует аутентификации

**GET /api/workouts/exercises/:id**
- Получение информации об упражнении
- Требует аутентификации

**POST /api/workouts/exercises**
- Создание нового упражнения
- Тело запроса: данные упражнения
- Требует аутентификации

**GET /api/workouts/muscle-groups**
- Получение списка групп мышц
- Требует аутентификации

**POST /api/workouts/sessions**
- Создание тренировочной сессии
- Тело запроса: `{ session_date, sets: [{ exercise_id, set_number, reps, weight_kg }] }`
- Требует аутентификации

**GET /api/workouts/sessions**
- Получение списка тренировочных сессий
- Параметры запроса: `start_date`, `end_date`
- Требует аутентификации

**GET /api/workouts/sessions/:id**
- Получение деталей тренировочной сессии
- Требует аутентификации

**DELETE /api/workouts/sessions/:id**
- Удаление тренировочной сессии
- Требует аутентификации

**GET /api/workouts/stats**
- Получение статистики тренировок
- Параметры запроса: `start_date`, `end_date`
- Требует аутентификации

### Рецепты

**GET /api/recipes**
- Получение списка рецептов
- Параметры запроса: `user_id` (опционально)
- Требует аутентификации

**GET /api/recipes/:id**
- Получение деталей рецепта
- Требует аутентификации

**POST /api/recipes**
- Создание нового рецепта
- Тело запроса: данные рецепта и ингредиенты
- Требует аутентификации

**PUT /api/recipes/:id**
- Обновление рецепта
- Тело запроса: данные рецепта
- Требует аутентификации

**DELETE /api/recipes/:id**
- Удаление рецепта
- Требует аутентификации

### AI-ассистент

**POST /api/ai/chat**
- Чат с AI-ассистентом
- Тело запроса: `{ message: string }`
- Возвращает: ответ AI-ассистента
- Требует аутентификации
- Rate limit: 60 запросов в 15 минут на пользователя

**POST /api/ai/recommendations/mealplan**
- Генерация рациона питания
- Тело запроса: `{ meals: number }` (количество приемов пищи, 3-6)
- Возвращает: план питания с приемами пищи и продуктами
- Требует аутентификации

**POST /api/ai/recommendations/mealplan/apply**
- Применение сгенерированного рациона в дневник питания
- Тело запроса: `{ plan: object, date: string }`
- Требует аутентификации

**POST /api/ai/recommendations/workout**
- Генерация плана тренировки
- Тело запроса: `{ location: string, duration_min: number }`
- Возвращает: план тренировки с упражнениями и подходами
- Требует аутентификации

**POST /api/ai/recommendations/workout/apply**
- Применение сгенерированной тренировки в дневник тренировок
- Тело запроса: `{ plan: object }`
- Требует аутентификации

## База данных

База данных состоит из 18 таблиц:

**Пользователи:**
- users - основная информация о пользователях
- user_profiles - профили с целями и параметрами
- body_measurements - история измерений параметров тела

**Питание:**
- products - база продуктов питания
- meals - приемы пищи
- meal_items - продукты в приемах пищи
- recipes - рецепты
- recipe_ingredients - ингредиенты рецептов

**Тренировки:**
- exercises - библиотека упражнений
- workout_sessions - тренировочные сессии
- workout_sets - подходы в тренировках
- workout_plans - планы тренировок

**AI:**
- ai_interactions - логирование всех AI-взаимодействий

**Интеграции:**
- health_integrations - интеграции с внешними сервисами

**Системные:**
- notifications - уведомления пользователей
- user_preferences - настройки пользователей

## Безопасность

- JWT токены для аутентификации с настраиваемым временем жизни
- Хеширование паролей с использованием bcrypt
- Rate limiting для защиты от злоупотреблений
- Валидация всех входящих запросов с помощью Celebrate/Joi
- Helmet для установки безопасных HTTP заголовков
- CORS настройка для контроля доступа
- Централизованная обработка ошибок

## Тестирование

Запуск тестов:
```bash
cd backend
npm test
```

Тесты используют Jest и Supertest для тестирования API endpoints.

## Развертывание

### Backend

1. Установите переменные окружения на продакшн сервере
2. Запустите миграции базы данных
3. Запустите сервер:
```bash
NODE_ENV=production npm start
```

### Frontend

1. Соберите приложение:
```bash
cd frontend
npm run build
```

2. Для мобильных платформ используйте Expo EAS Build или React Native CLI

## Функциональность

### Реализовано

- Полнофункциональный backend API с 30+ endpoints
- Схема базы данных PostgreSQL с 18 таблицами
- JWT аутентификация и авторизация
- AI-ассистент с интеграцией внешних AI API
- Генерация рационов питания с помощью AI
- Генерация планов тренировок с помощью AI
- Логирование всех AI-взаимодействий
- Валидация запросов на всех endpoints
- Централизованная обработка ошибок
- Rate limiting для защиты API
- Frontend на React Native с Expo
- Навигация между экранами
- Управление питанием с отслеживанием калорий и БЖУ
- Управление тренировками с библиотекой упражнений
- Профиль пользователя с настройками целей
- Лендинг-страница с информацией о проекте
- Страницы About и Features
- Современный дизайн с градиентами и анимациями
- Кэширование данных на клиенте
- Pull-to-refresh для обновления данных
- Обработка ошибок на клиенте
- Переиспользуемые компоненты

### В разработке

- Стриминг ответов AI
- История диалогов в UI
- Премиум-подписка с расширенными лимитами
- Push-уведомления
- Интеграция с фитнес-трекерами
- Графики прогресса
- Экспорт данных

## История изменений

### Изменения (10.12.2025)

**Улучшения AI-ассистента:**

- Реализована универсальная система ответов AI, способная отвечать на любые вопросы пользователя, сохраняя специализацию в фитнесе и здоровье
- Добавлена система определения контекста запросов с автоматическим распознаванием фитнес-связанных вопросов
- Реализована интеллектуальная система baseline-ответов, работающая без внешнего AI API:
  - Детальные планы питания для дефицита калорий с расчетом БЖУ и конкретными продуктами
  - Планы для набора массы с профицитом калорий и рекомендациями по питанию
  - Конкретные планы тренировок с упражнениями, подходами и повторениями
  - Контекстные ответы на основе профиля пользователя и текущего прогресса
- Добавлена система получения истории разговора для контекстных ответов (последние 3 пары сообщений)
- Реализована динамическая настройка параметров AI (temperature, maxTokens) в зависимости от типа запроса
- Улучшена обработка запросов на изменение/переделку с генерацией новых решений
- Добавлена расширенная обработка ошибок с детальным логированием для отладки

**Улучшения пользовательского интерфейса:**

- Реализована анимация печатания текста для ответов AI с постепенным появлением символов
- Добавлен мигающий курсор во время генерации ответа AI
- Улучшена визуальная обратная связь при обработке запросов AI
- Оптимизирована производительность анимаций для веб-платформы

**Технические улучшения:**

- Исправлена проблема с порядком определения переменных в AI-роутах
- Добавлены дополнительные проверки на null/undefined для предотвращения ошибок
- Улучшена обработка дат и форматирование данных профиля
- Оптимизирована логика формирования промптов для AI

**Результат:**

AI-ассистент теперь работает стабильно даже без внешнего AI API, предоставляя умные и контекстные ответы на основе данных пользователя. Анимация печатания улучшает пользовательский опыт и создает ощущение живого диалога с AI.

## Контакты

По вопросам проекта обращайтесь к авторам или руководителю проекта.
